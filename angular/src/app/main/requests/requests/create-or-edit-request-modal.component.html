<div bsModal #createOrEditModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="createOrEditModal" aria-hidden="true" [config]="{backdrop: 'static'}">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form *ngIf="active" #requestForm="ngForm" novalidate (ngSubmit)="save()" autocomplete="off">
                <div class="modal-header">
                    <h4 class="modal-title">
                        <span *ngIf="request.id && request.requestStatusId == 1">{{l("Treat Request")}}</span>
                        <span *ngIf="request.id && request.requestStatusId == 0">{{l("EditRequest")}}</span>
                        <span *ngIf="!request.id">{{l("CreateNewRequest")}}</span>
                    </h4>
                    <button type="button" class="close" (click)="close()" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="m-form__group form-group" *ngIf="!_callType">
                        <label for="">Request Type</label>
                        <div class="radio-inline">
                            <label class="radio">
                                <input type="radio" class="form-control" name="request.requestTypeId_Consultation" [(ngModel)]="request.requestTypeId" [value]="0"> {{l("Enum_RequestType_0")}}
                                <span></span>
                            </label>
                            <label class="radio">
                                <input type="radio" class="form-control" name="request.requestTypeId_Enquiry" [(ngModel)]="request.requestTypeId" [value]="1"> {{l("Enum_RequestType_1")}}
                                <span></span>
                            </label>
                            <label class="radio">
                                <input type="radio" class="form-control" name="request.requestTypeId_Enquiry" [(ngModel)]="request.requestTypeId" [value]="2"> {{l("Enum_RequestType_2")}}
                                <span></span>
                            </label>
                        </div>
                    </div>
                    <tabset class="tab-container tabbable-line">
                        <tab heading="{{l('Request Info')}}" customClass="m-tabs__item" *ngIf="request.requestTypeId == 0">
                            <div class="form-group m-form__group" *ngIf="request.id && request.requestStatusId != 1">
                                <label for="UserName">{{l("Name of Requestor")}}</label>
                                <div class="input-group">
                                    <input class="form-control" id="UserName" name="userName" [(ngModel)]="userName" type="text" disabled>
                                    <div class="input-group-append">
                                        <button class="btn btn-primary blue" (click)="openSelectUserModal()" type="button"><i class="fa fa-search"></i> {{l("Pick")}}</button>
                                    </div>
                                    <div class="input-group-prepend">
                                        <button class="btn btn-danger" type="button" (click)="setRequestorIdNull()"><i class="fa fa-close"></i></button>
                                    </div>
                                </div>
                            </div>
                            <input class="form-control" name="request.requestorId" [(ngModel)]="request.requestorId" type="text" hidden>

                            <div class="form-group m-form__group">
                                <label for="ClientListClientName">{{l("Client")}}</label>
                                <div class="input-group col-md-10 col-lg-8" style="padding-left: 0px; padding-right: 0px">
                                    <input class="form-control" id="ClientListClientName" name="clientListClientName" [(ngModel)]="clientListClientName" type="text" disabled>
                                    <div class="input-group-append">
                                        <button class="btn btn-primary blue" (click)="openSelectClientListModal()" type="button"><i class="fa fa-search"></i> {{l("Pick")}}</button>
                                    </div>
                                    <div class="input-group-prepend">
                                        <button class="btn btn-danger" type="button" (click)="setClientListIdNull()"><i class="fa fa-close"></i></button>
                                    </div>
                                </div>
                            </div>
                            <input class="form-control" name="request.clientListId" [(ngModel)]="request.clientListId" type="text" hidden>

                            <!--
                            <div class="form-group m-form__group">
                                <label for="RequestAreaRequestAreaName">{{l("RequestArea")}}</label>
                                <div class="input-group">
                                    <input class="form-control" id="RequestAreaRequestAreaName" name="requestAreaRequestAreaName" [(ngModel)]="requestAreaRequestAreaName" type="text" disabled>
                                    <div class="input-group-append">
                                        <button class="btn btn-primary blue" (click)="openSelectRequestAreaModal()" type="button"><i class="fa fa-search"></i> {{l("Pick")}}</button>
                                    </div>
                                    <div class="input-group-prepend">
                                        <button class="btn btn-danger" type="button" (click)="setRequestAreaIdNull()"><i class="fa fa-close"></i></button>
                                    </div>
                                </div>
                            </div>
                            <input class="form-control" name="request.requestAreaId" [(ngModel)]="request.requestAreaId" type="text" hidden>


                            <div class="form-group m-form__group">
                                <label for="RequestDomainDomainName">{{l("RequestDomain")}}</label>
                                <div class="input-group">
                                    <input class="form-control" id="RequestDomainDomainName" name="requestDomainDomainName" [(ngModel)]="requestDomainDomainName" type="text" disabled>
                                    <div class="input-group-append">
                                        <button class="btn btn-primary blue" (click)="openSelectRequestDomainModal()" type="button"><i class="fa fa-search"></i> {{l("Pick")}}</button>
                                    </div>
                                    <div class="input-group-prepend">
                                        <button class="btn btn-danger" type="button" (click)="setRequestDomainIdNull()"><i class="fa fa-close"></i></button>
                                    </div>
                                </div>
                            </div>
                            <input class="form-control" name="request.requestDomainId" [(ngModel)]="request.requestDomainId" type="text" hidden>
-->

                            <div class="form-group">
                                <label>Request area</label>
                                <div></div>
                                <select class="custom-select form-control col-md-10 col-lg-8" name="request.requestAreaId" [(ngModel)]="request.requestAreaId">
                                      <!--<option *ngFor="let c of countries" [ngValue]="c">Open this select menu</option>-->
                                      <option value="1">Accounting</option>
                                      <option value="2">Audit</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Request domain</label>
                                <div></div>
                                <select class="custom-select form-control col-md-10 col-lg-8" name="request.requestDomainId" [(ngModel)]="request.requestDomainId">
                                      <!--<option *ngFor="let c of countries" [ngValue]="c">Open this select menu</option>-->
                                      <option value="1">IFRS</option>
                                      <option value="2">IFRS for SMEs</option>
                                </select>
                            </div>


                            <div class="form-group">
                                <label for="Request_LocalChargeCode">{{l("LocalChargeCode")}}</label>
                                <input type="text" id="Request_LocalChargeCode" class="form-control col-md-10 col-lg-8" [(ngModel)]="request.localChargeCode" name="LocalChargeCode" minlength="1" maxlength="20" [disabled]="request.id && request.requestStatusId != 0" />
                            </div>

                            <div class="form-group m-form__group">
                                <label for="UserName3">{{l("Requesting Manager")}}</label>
                                <div class="input-group col-md-10 col-lg-8" style="padding-left: 0px; padding-right: 0px">
                                    <input class="form-control" id="UserName3" name="userName3" [(ngModel)]="userName3" type="text" disabled>
                                    <div class="input-group-append">
                                        <button class="btn btn-primary blue" (click)="openSelectUserModal3()" type="button"><i class="fa fa-search"></i> {{l("Pick")}}</button>
                                    </div>
                                    <div class="input-group-prepend">
                                        <button class="btn btn-danger" type="button" (click)="setRequestorManagerIdNull()"><i class="fa fa-close"></i></button>
                                    </div>
                                </div>
                            </div>
                            <input class="form-control" name="request.requestorManagerId" [(ngModel)]="request.requestorManagerId" type="text" hidden required>

                            <div class="form-group m-form__group">
                                <label for="UserName2">{{l("Requesting Partner")}}</label>
                                <div class="input-group col-md-10 col-lg-8" style="padding-left: 0px; padding-right: 0px">
                                    <input class="form-control" id="UserName2" name="userName2" [(ngModel)]="userName2" type="text" disabled>
                                    <div class="input-group-append">
                                        <button class="btn btn-primary blue" (click)="openSelectUserModal2()" type="button"><i class="fa fa-search"></i> {{l("Pick")}}</button>
                                    </div>
                                    <div class="input-group-prepend">
                                        <button class="btn btn-danger" type="button" (click)="setRequestorPartnerIdNull()"><i class="fa fa-close"></i></button>
                                    </div>
                                </div>
                            </div>
                            <input class="form-control" name="request.requestorPartnerId" [(ngModel)]="request.requestorPartnerId" type="text" hidden required>

                            <div class="form-group m-form__group row">
                                <label for="Request_RequiredResponseDate" class="col-md-12">{{l("RequiredResponseDate")}}</label>
                                <div class="col-lg-10 col-md-9 col-sm-8">
                                    <input class="form-control m-input" type="datetime" bsDatepicker datePickerMomentModifier
                                    [(date)]="request.requiredResponseDate" id="Request_RequiredResponseDate">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="Request_Background">{{l("ReasonResponseDate")}}</label>
                                <label style="font-style: italic; font-size: 80%" for="Request_Background"></label>
                                <div class="card-body">
                                    <div class="form-group m-form__group">
                                        <p-editor id="Request_ReasonResponseDate" [(ngModel)]="request.reasonResponseDate" name="ReasonResponseDate" [style]="{'height':'100px'}"></p-editor>
                                    </div>
                                </div>
                            </div>

                            <br />
                            <div class="m-checkbox-list">
                                <label for="Request_IssueDiscussed" class="m-checkbox">
                                    <input id="Request_IssueDiscussed" type="checkbox" name="IssueDiscussed" [(ngModel)]="request.issueDiscussed">
                                    {{l("IssueDiscussed")}}
                                    <span></span>
                                </label>
                            </div>

                            <div class="form-group" *ngIf="request.issueDiscussed">
                                <label for="Request_IssueDiscussedWith">{{l("IssueDiscussedWith")}}</label>
                                <input type="text" id="Request_IssueDiscussedWith" class="form-control" [(ngModel)]="request.issueDiscussedWith" name="IssueDiscussedWith" />
                            </div>

                        </tab>

                        <tab heading="{{l('Request Details')}}" customClass="m-tabs__item" *ngIf="request.requestTypeId == 0">

                            <div class="form-group">
                                <label for="Request_ConsultationIssue">{{l("ConsultationIssue")}}</label>
                                <label style="font-style: italic; font-size: 80%" for="Request_ConsultationIssue">{{l("ConsultationIssueNote")}}</label>
                                <div class="card-body">
                                    <div class="form-group m-form__group">
                                        <p-editor id="Request_ConsultationIssue" [(ngModel)]="request.consultationIssue" name="ConsultationIssue" [style]="{'height':'140px'}" [readonly]="request.id && request.requestStatusId != 0"></p-editor>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="Request_Background">{{l("Background, Facts and Circumstances")}}</label>
                                <label style="font-style: italic; font-size: 80%" for="Request_Background">{{l("BackgroundNote")}}</label>
                                <div class="card-body">
                                    <div class="form-group m-form__group">
                                        <p-editor id="Request_Background" [(ngModel)]="request.background" name="Background" [style]="{'height':'140px'}"></p-editor>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="Request_TechReference">{{l("TechReference")}}</label>
                                <label style="font-style: italic; font-size: 80%" for="Request_TechReference">{{l("TechnicalReferenceNote")}}</label>
                                <div class="card-body">
                                    <div class="form-group m-form__group">
                                        <p-editor id="Request_TechReference" [(ngModel)]="request.techReference" name="TechReference" [style]="{'height':'140px'}" [readonly]="request.id && request.requestStatusId != 0"></p-editor>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="Request_AgreedGuidance">{{l("AgreedGuidance")}}</label>
                                <label style="font-style: italic; font-size: 80%" for="Request_AgreedGuidance">{{l("AgreedGuidanceNote")}}</label>
                                <div class="card-body">
                                    <div class="form-group m-form__group">
                                        <p-editor id="Request_AgreedGuidance" [(ngModel)]="request.agreedGuidance" name="AgreedGuidance" [style]="{'height':'140px'}" [readonly]="request.id && request.requestStatusId != 0"></p-editor>
                                    </div>
                                </div>
                            </div>
                            <div class="card card-custom gutter-b">
                                <div class="m-portlet__head">
                                    <div class="m-portlet__head-caption">
                                        <div class="m-portlet__head-title">
                                            <h3 class="m-portlet__head-text">
                                                {{l("Document Upload")}}
                                            </h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <form role="form">
                                        <div class="form-group m-form__group">
                                            <label for="DefaultFileUploadFileInput" class="control-label">file uploader</label>
                                            <p-fileUpload multiple="multiple" id="DefaultFileUploadFileInput" name="DefaultFileUploadFileInput[]" [url]="uploadUrl" maxFileSize="100000000" (onUpload)="onUpload($event)" (onBeforeSend)="onBeforeSend($event)">
                                                <ng-template pTemplate="content">
                                                    <ul *ngIf="uploadedFiles.length">
                                                        <li *ngFor="let file of uploadedFiles">{{file.name}} - {{file.size}} bytes</li>
                                                    </ul>
                                                </ng-template>
                                            </p-fileUpload>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </tab>
                        <tab heading="{{l('Technical Group Response')}}" customClass="m-tabs__item" *ngIf="_callType == 2 && request.requestTypeId == 0">
                            <div class="form-group">
                                <label for="Request_TechGrpResponse">{{l("TechGrpResponse")}}</label>
                                <label style="font-style: italic; font-size: 80%" for="Request_TechGrpResponse">{{l("TechnicalGroupResponseNote")}}</label>
                                <div class="card-body">
                                    <div class="form-group m-form__group">
                                        <p-editor id="Request_TechGrpResponse" [(ngModel)]="request.techGrpResponse" name="TechGrpResponse" [style]="{'height':'200px'}"></p-editor>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="Request_TechConclusion">{{l("TechConclusion")}}</label>
                                <label for="Request_TechConclusion"></label>
                                <div class="card-body">
                                    <div class="form-group m-form__group">
                                        <p-editor id="Request_TechConclusion" [(ngModel)]="request.techConclusion" name="TechConclusion" [style]="{'height':'120px'}"></p-editor>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="Request_OtherConsideration">{{l("OtherConsideration")}}</label>
                                <label for="Request_OtherConsideration"></label>
                                <div class="card-body">
                                    <div class="form-group m-form__group">
                                        <p-editor id="Request_OtherConsideration" [(ngModel)]="request.otherConsideration" name="OtherConsideration" [style]="{'height':'120px'}"></p-editor>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group" hidden>
                                <label for="Request_RequestStatusId">{{l("RequestStatusId")}}</label>
                                <select class="form-control" name="RequestStatusId" id="Request_RequestStatusId" [(ngModel)]="request.requestStatusId">
                                    <option value="0">{{l('Enum_RequestStatus_0')}}</option>

                                    <option value="1">{{l('Enum_RequestStatus_1')}}</option>

                                    <option value="2">{{l('Enum_RequestStatus_2')}}</option>

                                    <option value="3">{{l('Enum_RequestStatus_3')}}</option>

                                    <option value="4">{{l('Enum_RequestStatus_4')}}</option>

                                    <option value="5">{{l('Enum_RequestStatus_5')}}</option>

                                    <option value="6">{{l('Enum_RequestStatus_6')}}</option>

                                </select>
                            </div>

                        </tab>
                        <tab heading="{{l('Enquiry')}}" customClass="m-tabs__item" *ngIf="request.requestTypeId == 1">
                            <div class="form-group m-form__group">
                                <div class="form-group">
                                    <label for="Request_Enquiry">{{l("Enquiry")}}</label>
                                    <div class="card-body">
                                        <div class="form-group m-form__group">
                                            <p-editor id="Request_Enquiry" [(ngModel)]="request.enquiry" name="Enquiry" [style]="{'height':'200px'}"></p-editor>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group" *ngIf="_callType == 2">
                                    <label for="Request_EnquiryResponse">{{l("Response")}}</label>
                                    <div class="card-body">
                                        <div class="form-group m-form__group">
                                            <p-editor id="Request_EnquiryResponse" [(ngModel)]="request.enquiryResponse" name="EnquiryResponse" [style]="{'height':'200px'}"></p-editor>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </tab>
                        <tab heading="{{l('Technical Team')}}" customClass="m-tabs__item" *ngIf="_callType == 1">
                            <div class="form-group m-form__group">
                                <label>{{l("Team Members")}}</label>

                                <div class="table-responsive col-md-10 border">
                                    <table class="table table-sm">
                                        <thead>

                                            <tr>
                                                <th scope="col">Name</th>

                                                <th scope="col" class="pull-right"><button class="btn btn-sm btn-success" (click)="openSelectUserModal5()" type="button"><i class="fa fa-plus"></i> {{l("Add")}}</button></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let item of techTeamMembers">
                                                <td scope="row">{{item.displayName}}</td>

                                                <td class="pull-right"><button class="btn btn-danger btn-sm" (click)="removeapproverUserId(item.id)" type="button"><i class="fa fa-trash"></i></button></td>

                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </tab>
                        <tab heading="{{l('TOR')}}" customClass="m-tabs__item" *ngIf="_callType == 3 || _callType == 4">
                            <div class="form-group m-form__group">
                                <div class="form-group">
                                    <label for="Request_Enquiry">{{l("TOR")}}</label>
                                    <div class="card-body">
                                        <div class="form-group m-form__group">
                                            <p-editor id="Request_TermsOfRef" [(ngModel)]="request.termsOfRef" name="TermsOfRef" [style]="{'height':'300px'}"></p-editor>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </tab>
                        <tab heading="{{l('FS Review')}}" customClass="m-tabs__item" *ngIf="request.requestTypeId == 2">
                            
                        </tab>
                    </tabset>
                </div>
                <div class="modal-footer">
                    <button [disabled]="saving" type="button" class="btn btn-default" (click)="close()">{{l("Cancel")}}</button>
                    <button type="submit" class="btn btn-primary blue" [disabled]="!requestForm.form.valid" [buttonBusy]="saving" [busyText]="l('SavingWithThreeDot')" *ngIf="!_callType || _callType == 0 || _callType == 2"><i class="fa fa-save"></i> <span>{{l("Submit")}}</span></button>
                    <button type="button" (click)="saveTechMember()" class="btn btn-primary blue" [disabled]="!requestForm.form.valid" [buttonBusy]="saving" [busyText]="l('SavingWithThreeDot')" *ngIf="_callType == 1"><i class="fa fa-save"></i> <span>{{l("AssignTeam")}}</span></button>
                    <button type="button" (click)="sendTOR()" class="btn btn-primary blue" [disabled]="!requestForm.form.valid" [buttonBusy]="saving" [busyText]="l('SavingWithThreeDot')" *ngIf="_callType == 3"><i class="fa fa-save"></i> <span>{{l("SendTOR")}}</span></button>
                    <button type="button" (click)="approveTOR()" class="btn btn-primary blue" [disabled]="!requestForm.form.valid" [buttonBusy]="saving" [busyText]="l('SavingWithThreeDot')" *ngIf="_callType == 4"><i class="fa fa-save"></i> <span>{{l("ApproveTOR")}}</span></button>
                    <button type="button" (click)="approveRequest()" class="btn btn-primary blue" [disabled]="!requestForm.form.valid" [buttonBusy]="saving" [busyText]="l('SavingWithThreeDot')" *ngIf="_callType == 5"><i class="fa fa-save"></i> <span>{{l("ApproveRequest")}}</span></button>
                </div>
            </form>
        </div>
    </div>
    <requestAreaLookupTableModal #requestAreaLookupTableModal (modalSave)="getNewRequestAreaId()"></requestAreaLookupTableModal>
    <requestDomainLookupTableModal #requestDomainLookupTableModal (modalSave)="getNewRequestDomainId()"></requestDomainLookupTableModal>
    <userLookupTableModal #userLookupTableModal (modalSave)="getNewRequestorId()"></userLookupTableModal>
    <userLookupTableModal #userLookupTableModal2 (modalSave)="getNewRequestorPartnerId()"></userLookupTableModal>
    <userLookupTableModal #userLookupTableModal3 (modalSave)="getNewRequestorManagerId()"></userLookupTableModal>
    <clientListLookupTableModal #clientListLookupTableModal (modalSave)="getNewClientListId()"></clientListLookupTableModal>
    <userLookupTableModal #userLookupTableModal4 (modalSave)="getNewAssigneeId()"></userLookupTableModal>
    <userLookupTableModal #userLookupTableModal5 (modalSave)="getNewTechTeamMember()"></userLookupTableModal>

</div>
